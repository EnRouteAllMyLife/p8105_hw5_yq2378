p8105_hw5_yq2378
================
Qi Yumeng
2023-11-12

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.3     ✔ readr     2.1.4
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.0
    ## ✔ ggplot2   3.4.4     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.3     ✔ tidyr     1.3.0
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(ggpubr)
```

``` r
# loading data
homicide = read.csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv")
```

``` r
homicide = homicide %>% 
  mutate(city_state = str_c(city, state, sep=", ")) 
ttl_bycity = homicide %>% 
  mutate(if_solved = if_else(disposition == "Closed by arrest",1,0 )) %>% 
  group_by(city) %>% summarise( ttl_cnt = n(), unsolved_cnt = n() - sum(if_solved), .groups = "keep") %>%
  arrange(desc(ttl_cnt)) 
ttl_bycity
```

    ## # A tibble: 50 × 3
    ## # Groups:   city [50]
    ##    city         ttl_cnt unsolved_cnt
    ##    <chr>          <int>        <dbl>
    ##  1 Chicago         5535         4073
    ##  2 Philadelphia    3037         1360
    ##  3 Houston         2942         1493
    ##  4 Baltimore       2827         1825
    ##  5 Detroit         2519         1482
    ##  6 Los Angeles     2257         1106
    ##  7 St. Louis       1677          905
    ##  8 Dallas          1567          754
    ##  9 Memphis         1514          483
    ## 10 New Orleans     1434          930
    ## # ℹ 40 more rows

For the city of Baltimore, MD, use the prop.test function to estimate
the proportion of homicides that are unsolved; save the output of
prop.test as an R object, apply the broom::tidy to this object and pull
the estimated proportion and confidence intervals from the resulting
tidy dataframe

``` r
ttl_cnt = 2827
unsolved_cnt = 1825
prop_output = prop.test(x = unsolved_cnt, n = ttl_cnt)
broom::tidy(prop_output)
```

    ## # A tibble: 1 × 8
    ##   estimate statistic  p.value parameter conf.low conf.high method    alternative
    ##      <dbl>     <dbl>    <dbl>     <int>    <dbl>     <dbl> <chr>     <chr>      
    ## 1    0.646      239. 6.46e-54         1    0.628     0.663 1-sample… two.sided

``` r
broom::tidy(prop_output) %>% pull(estimate)
```

    ##         p 
    ## 0.6455607

``` r
broom::tidy(prop_output) %>% pull(conf.low, conf.high)
```

    ## 0.663159860401662 
    ##         0.6275625

``` r
CI_bycity = 
  ttl_bycity |>
  mutate(prop_output = map2(.x = unsolved_cnt, .y = ttl_cnt, prop.test),
         prop_output = map(prop_output,broom::tidy)) |> 
  unnest(prop_output) |>
  mutate(CI = paste("(",round(conf.low,4),", ", round(conf.high,4),")"),
         estimate = round(estimate, 4)) |>
  select(city, ttl_cnt, unsolved_cnt, estimate,CI, conf.low, conf.high)
CI_bycity
```

    ## # A tibble: 50 × 7
    ## # Groups:   city [50]
    ##    city         ttl_cnt unsolved_cnt estimate CI              conf.low conf.high
    ##    <chr>          <int>        <dbl>    <dbl> <chr>              <dbl>     <dbl>
    ##  1 Chicago         5535         4073    0.736 ( 0.724 ,  0.7…    0.724     0.747
    ##  2 Philadelphia    3037         1360    0.448 ( 0.43 ,  0.46…    0.430     0.466
    ##  3 Houston         2942         1493    0.507 ( 0.4892 ,  0.…    0.489     0.526
    ##  4 Baltimore       2827         1825    0.646 ( 0.6276 ,  0.…    0.628     0.663
    ##  5 Detroit         2519         1482    0.588 ( 0.5688 ,  0.…    0.569     0.608
    ##  6 Los Angeles     2257         1106    0.49  ( 0.4692 ,  0.…    0.469     0.511
    ##  7 St. Louis       1677          905    0.540 ( 0.5154 ,  0.…    0.515     0.564
    ##  8 Dallas          1567          754    0.481 ( 0.4562 ,  0.…    0.456     0.506
    ##  9 Memphis         1514          483    0.319 ( 0.2957 ,  0.…    0.296     0.343
    ## 10 New Orleans     1434          930    0.648 ( 0.6231 ,  0.…    0.623     0.673
    ## # ℹ 40 more rows

``` r
CI_bycity |>
  ggplot(aes(x = factor(city), y = estimate))+ 
  geom_point(size = 0.8) + 
  geom_errorbar(aes(ymin = conf.low,  ymax = conf.high), width = 0.2) + 
  coord_flip() + 
  theme_pubr() + xlab("City") + ylab("Estimate the Proportion of unsolved homicides") +
  theme(text = element_text(size = 8),
        plot.margin = unit(c(.1,.1,.1,.1),'cm'),
        legend.title = element_blank())
```

![](p8105_hw5_yq2378_files/figure-gfm/error_bar-1.png)<!-- -->
