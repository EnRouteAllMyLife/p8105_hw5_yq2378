p8105_hw5_yq2378
================
Qi Yumeng
2023-11-12

``` r
library(tidyverse)
```

    ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──

    ## ✔ ggplot2 3.4.4     ✔ purrr   1.0.2
    ## ✔ tibble  3.2.1     ✔ dplyr   1.1.3
    ## ✔ tidyr   1.3.0     ✔ stringr 1.5.0
    ## ✔ readr   2.1.4     ✔ forcats 1.0.0

    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()

``` r
# loading data
homicide = read.csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv")
```

``` r
homicide = homicide %>% 
  mutate(city_state = str_c(city, state, sep=", ")) 
ttl_bycity = homicide %>% 
  mutate(if_solved = if_else(disposition == "Closed by arrest",1,0 )) %>% 
  group_by(city) %>% summarise( ttl_homicides = n(), unsolved_homicides = n() - sum(if_solved), .groups = "keep") %>%
  arrange(desc(ttl_homicides)) 
ttl_bycity
```

    ## # A tibble: 50 × 3
    ## # Groups:   city [50]
    ##    city         ttl_homicides unsolved_homicides
    ##    <chr>                <int>              <dbl>
    ##  1 Chicago               5535               4073
    ##  2 Philadelphia          3037               1360
    ##  3 Houston               2942               1493
    ##  4 Baltimore             2827               1825
    ##  5 Detroit               2519               1482
    ##  6 Los Angeles           2257               1106
    ##  7 St. Louis             1677                905
    ##  8 Dallas                1567                754
    ##  9 Memphis               1514                483
    ## 10 New Orleans           1434                930
    ## # ℹ 40 more rows

For the city of Baltimore, MD, use the prop.test function to estimate
the proportion of homicides that are unsolved; save the output of
prop.test as an R object, apply the broom::tidy to this object and pull
the estimated proportion and confidence intervals from the resulting
tidy dataframe

``` r
ttl_cnt = 2827
unsolved_cnt = 1825
prop_output = prop.test(x = unsolved_cnt, n = ttl_cnt)
broom::tidy(prop_output)
```

    ## # A tibble: 1 × 8
    ##   estimate statistic  p.value parameter conf.low conf.high method    alternative
    ##      <dbl>     <dbl>    <dbl>     <int>    <dbl>     <dbl> <chr>     <chr>      
    ## 1    0.646      239. 6.46e-54         1    0.628     0.663 1-sample… two.sided

``` r
broom::tidy(prop_output) %>% pull(estimate)
```

    ##         p 
    ## 0.6455607

``` r
broom::tidy(prop_output) %>% pull(conf.low, conf.high)
```

    ## 0.663159860401662 
    ##         0.6275625

Now run prop.test for each of the cities in your dataset, and extract
both the proportion of unsolved homicides and the confidence interval
for each. Do this within a “tidy” pipeline, making use of purrr::map,
purrr::map2, list columns and unnest as necessary to create a tidy
dataframe with estimated proportions and CIs for each city.

``` r
#map(.x = ttl_bycity$unsolved_homicides,.y = ttl_bycity$ttl_homicides, )
```
